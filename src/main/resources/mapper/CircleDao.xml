<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dhu.dao.CircleDao">
    <select id="selectByName" parameterType="String" resultType="Circle">
        <bind name="pattern" value="'%' + circleName + '%'"/>
        # 模糊查询
        select *
        from circle
        where circleName like #{pattern}
        order by circleTime DESC
    </select>

    <select id="selectTen" resultType="CircleView">
        select *
        from hotcircle
        ORDER BY hot DESC
        limit 0,10
    </select>

    <select id="selectById" resultType="Circle">
        select *
        from circle
        where circle_UserId = #{userId}
    </select>

    <insert id="insertCircle" parameterType="Circle">
        insert into circle(circleName, circleImg, circleContent, circleLife, circleTime, circle_UserId)
        values (#{circleName}, #{circleImg}, #{circleContent}, #{circleLife}, #{circleTime}, #{circle_UserId})
    </insert>

    <insert id="insertConnection">
        insert into connectuserandcircle(userId, circleId)
        values (#{userId}, #{circleId})
    </insert>

    <select id="selectByCircleId" resultType="Circle">
        select *
        from circle
        where circleId = #{circleId}
    </select>

    <select id="selectConnection" resultType="java.lang.String">
        select userId
        from connectuserandcircle
        where userId = #{userId}
          and circleId = #{circleId}
    </select>

    <select id="selectUserInCircle" resultType="User">
        select u.*
        from connectuserandcircle c,
             user u
        where c.circleId = #{circleId}
          and c.userId = u.userId
        order by u.userTime DESC
    </select>

    <select id="selectConnectionById" resultType="circle">
        select c.*
        from connectuserandcircle con,
             circle c
        where con.userId = #{userId}
          and con.circleId = c.circleId
        order by c.circleTime DESC
    </select>

    <select id="GetCircleMaster" resultType="User">
        select user.*
        from circle,
             user
        where circleId = #{circleId}
          and circle_UserId = #{circle_UserId}
          and circle.circle_UserId = user.userId
    </select>

    <select id="getCircleNameById" resultType="java.lang.String">
        select circleName
        from circle
        where circleId = #{circleId}
    </select>

    <select id="matchCircleName" resultType="java.lang.Integer">
        select count(*)
        from circle
        where circleName = #{circleName}
    </select>

    <delete id="deleteCircle">
        delete
        from circle
        where circleId = #{circleId}
    </delete>

    <delete id="deleteCircleConnection">
        delete
        from connectuserandcircle c
        where c.circleId = #{circleId}
    </delete>

    <delete id="deleteConnection">
        delete
        from connectuserandcircle
        where circleId = #{circleId}
          and userId = #{userId}
    </delete>

    <update id="updateCircleMaster" parameterType="Circle">
        update circle
        set circle_UserId=#{circle_UserId}
        where circleId = #{circleId}
    </update>
    <update id="updateCircleContent">
        update circle
        set circleName=#{circleName},
            circleImg=#{circleImg},
            circleContent=#{circleContent}
        where circleId = #{circleId}
    </update>

</mapper>